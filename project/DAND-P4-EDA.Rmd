---
title: "EDA of Red Wine Quality Data"
author: "Mahlon Barrault"
date: "December 14, 2016"
output: html_document
---
========================================================

```{r setup, echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)
library(gridExtra)
library(GGally)
library(reshape2)

# Load the Data
wine_quality <- read.csv("../Data/wineQualityReds.csv")

```

# Univariate Plots Section
```{r echo=TRUE, Univariate_Plots1}
summary(wine_quality)
```
I think it might be useful to have quality as a factor

```{r echo=TRUE, Univariate_Plots2}
wine_quality$quality <- factor(ordered(wine_quality$quality))
str(wine_quality$quality)
summary(wine_quality$quality)
```

Now that I am happy with how quality is looking lets see what it looks like

```{r echo=FALSE, Univariate_Plots3}
ggplot(data = wine_quality, aes(x = quality)) + geom_bar(stat = "count") 
```
No scores of less than 3. Scores of 3 and 4 are uncommon. 5 or better represents the bulk of the wines.
After seeing the distribution of quality I wanted to check the mean and standard deviation. It was a little tricky after converting quality to a factor.

```{r echo=TRUE, Univariate_Plots4}
qual_mean <- mean(as.numeric(levels(wine_quality$quality)[wine_quality$quality]))
qual_sd <- sd(as.numeric(levels(wine_quality$quality)[wine_quality$quality]))
qual_mean
qual_sd
```
The mean and standard deviation look appropriate for this distribution

Now let's look at some of the other variables that could contribute to the quality rating

Let's see what the variables related to acidity look like.

For single variable analysis I prefer the density plot since you don't have to be overly concerned tweaking the binwidth.

```{r echo=FALSE, Univariate_Plots}
ggplot(data = wine_quality, aes(x = fixed.acidity)) + geom_density()
```

```{r echo=FALSE, Univariate_Plots5}
ggplot(data = wine_quality, aes(x = volatile.acidity)) + geom_density()
```
There is an interesting bimodal distributing happening here with volatile.acidity.

```{r echo=FALSE, Univariate_Plots7}
ggplot(data = wine_quality, aes(x = citric.acid)) + geom_density()
ggplot(data = wine_quality, aes(x = citric.acid)) + geom_histogram(binwidth = 0.01)
```

Several wines have 0.00 g/L citric acid. There is an interesting spike of wines with 0.24 and 0.49 g/L citric acid. I wonder if these could additional modes could indicate wine from a specific producer.

```{r echo=FALSE}
# http://mgimond.github.io/ES218/Week05a.html
ggplot(wine_quality, aes(x=1, y=citric.acid)) + 
  geom_boxplot() +
  xlab(NULL) + 
  theme(axis.text.y=element_blank()) + 
  coord_flip() +
  scale_y_continuous(limits = c(0, 1.1), breaks = seq(0, 1.1, 0.1))
      
```


```{r echo=FALSE, Univariate_Plots9}
ggplot(data = wine_quality, aes(x = pH)) + geom_density()
```

Most wines in this data set fall between 3.1 and 3.5

Now let's see what the variables for sulphate and related compound content looks like

```{r echo=FALSE, Univariate_Plots10}
ggplot(data = wine_quality, aes(x = free.sulfur.dioxide)) + geom_density()
```

```{r echo=FALSE, Univariate_Plots11}
ggplot(data = wine_quality, aes(x = total.sulfur.dioxide)) + geom_density()
```

```{r echo=FALSE, Univariate_Plots12}
ggplot(data = wine_quality, aes(x = sulphates)) + geom_density()
```

All of the sulphate variables seem to have a similar right skew. There seem to be some wines with very high sulphate content relative to the rest of the wines.

Finally let's see what alcohol and related parameters looks like:

```{r echo=FALSE, Univariate_Plots13}
ggplot(data = wine_quality, aes(x = alcohol)) + geom_density()
```

Most wines have 

```{r echo=FALSE, Univariate_Plots14}
ggplot(data = wine_quality, aes(x = density)) + geom_density()
```

```{r echo=FALSE, Univariate_Plots15}
ggplot(aes(x = residual.sugar), data = wine_quality) + geom_density()
```

There are some wines with very high residual sugars; let's zoom in on the mean:

```{r echo=FALSE}
ggplot(aes(x = residual.sugar), data = wine_quality) + 
  geom_density() + 
  scale_x_continuous(limits = c(0, 6))
```

Seems like most of the values are between 1.5 and 2.5.
There seems to be areas of increased frequency at 4 and 5 out on the tail.

```{r echo=FALSE}
ggplot(aes(x = residual.sugar), data = wine_quality) + 
  geom_density() + 
  scale_x_continuous(limits = c(3, 7))
```

There seemed to be some secondary modes in the original plot, however I think all I was noticing places where there sparse values making it seem like an additional peak.

```{r echo=FALSE}
# http://mgimond.github.io/ES218/Week05a.html
ggplot(wine_quality, aes(x=1, y=residual.sugar)) + 
  geom_boxplot() +
  xlab(NULL) + 
  theme(axis.text.y=element_blank()) + 
  coord_flip() +
  scale_y_continuous(limits = c(0, 17), breaks = seq(0, 17, 1))
      
```
Box plot confirms what I was seeing in the density plot - most of the falling in a narrow lower band with some widely spaced outliers.

Looks like most of the red wine sampled fell in the 9% to 11% ABV range. Alcohol volumes of 9.5% and 10.9% seem to more common. The plot of the density variable looks almost too perfectly normally distributed. It does make sense since there aren't many wines with a very high alcohol content or very high residual sugars. I was expecting the alcohol and residual sugar plots to appear very similar. The relationship between these two variables must be more complex than I expected.

# Univariate Analysis

### What is the structure of your dataset?
```{r}
str(wine_quality)
```
There are 1599 red wines in this data set each with measurements of 11 of their physio-chemical properties and a sensory measurement of quality. The quality variable is the median of at least 3 taste tests by wine experts. I have chosen to make quality and ordered factor to reflect the specification the researchers used when collecting these data - the higher the number, the better the wine.

### What is/are the main feature(s) of interest in your dataset?
The data set has several related groups of variables. With a view to predicting a quality rating one might consider the primary flavor or aromatic factors such as acidity (fixed.acidity, volatile.acidity, citric.acid) or sweetness (residual.sugars). The data set provides other measurements of interest. I am particularly interested in discovering if the group of variables for amounts of sulfur containing compounds (free.sulfur.dioxide, total.sulfur.dioxide, sulphates) has any effect on the quality score.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
I suspect that there might be multicolinearity in this data since often times the presence of higher acidity or sugars can alter ones perception of other compounds. I plan to investigate the how acidity and higher sugar content work in conjunction with the sulfur containing compound to effect the quality rating.

### Did you create any new variables from existing variables in the dataset?
Most of the variables in this data set seemed to be valuable on their own and there wasn't any clear way to combine any of them in a meaningful way. One alteration I did make was to convert the quality variable in to a factor for easier analysis.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
Some of the distributions were unexpected but not bizarre in any way.


# Bivariate Plots Section

What are the driving corellations?

```{r echo=TRUE, Bivariate_Plots0.1}
wq <- wine_quality[, !(names(wine_quality) %in% c("X"))]
wq$quality <- as.numeric(levels(wq$quality)[wq$quality])
wq.cor <- cor(wq)
data.frame(wq.cor)
# Using default continuous color map
ggcorr(wq, label = TRUE, hjust = 0.9, layout.exp = 2)
# Using default descrete color map
ggcorr(wq, nbreaks = 3, label = TRUE, hjust = 0.9, layout.exp = 2)
```

Seeing this correllation plot I am curious if the taste testers were aware of the wine's alcohol content during tasting. If so, I would be concerned that this is a source of bias in these data. The alcohol variable seems to explain about substantial amount of the variance in the quality variable. volatile.acidity has fairly high negative correllation to the quality variable. Not surprised about that. Aceitic acid vapor is not what most people are looking for when they take the first sip. I am curious about the slightly elevated correllation of sulphates and the quality variable.

```{r echo=TRUE, Bivariate_Plots}
ggplot(wine_quality, aes(x = quality, y = alcohol)) +
  geom_point(alpha = 1/25)
```
Tried several alpha values. There seems to be a lower mean when quality is 5 but a scatter plot with a factor makes things a little crowded. Probably better as box plot I am thinking.

```{r echo=TRUE, Bivariate_Plots}
ggplot(wine_quality, aes(x = quality, y = alcohol)) +
  geom_boxplot()
```
That's better. With the box plot you can the trend from the scatter plot more clearly. Most of the lower scores tend to have an alcohol content around 10. Scores of 5 are densly packed around the mean with several outliers, some of which are extreme. Starting with scores of 6 and above there seems to be an upward trend in the mean alcohol content. To keep this in prespective I want to remind myself how many observations fall in to each of the scores.

```{r echo=TRUE, Bivariate_Plots}
summary(wine_quality$quality)
```



# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}
# http://stackoverflow.com/questions/34975190/set-alpha-and-remove-black-outline-of-density-plots-in-ggpairs
ggscatalpha <- function(data, mapping, ...) {
  ggplot(data = data, mapping = mapping) +
    geom_point(..., alpha = 0.25)
}

ggdensalpha <- function(data, mapping, ...) {
  ggplot(data = data, mapping = mapping) +
    geom_density(..., alpha = 0.25)
}
```

Let's have a look at all the pairs so I know where to spend additional time:

```{r echo=FALSE, Multivariate_Plots}
wq.names.acid <- c("fixed.acidity", "volatile.acidity", "citric.acid", "pH")
ggpairs(wine_quality,
        columns = wq.names.acid, 
        mapping = aes(color = quality), 
        lower = list(continuous = ggscatalpha), 
        diag = list(continuous = ggdensalpha))
```

The negative correlation between citric.acid and volatile.acid is interesting here. I will be sure to investigate that further. Also, it seems like the highest rated wines have lower volatile.acidity and higher citric.acid. On the other hand, the lowest rated wines tend to have higher volatile.acidity.

```{r echo=FALSE, Bivariate_Plots2}
wq.names.sulphur <- c("free.sulfur.dioxide", "total.sulfur.dioxide", "sulphates", "chlorides")
ggpairs(wine_quality,
        columns = wq.names.sulphur,
        mapping = aes(color = quality),
        lower = list(continuous = ggscatalpha), 
        diag = list(continuous = ggdensalpha))
```

Surprisingly, it would seem like higher sulphates has a positive effect on the wine's rating.
 
```{r echo=FALSE, Bivariate_Plots3}
wq.names.alcohol <- c("alcohol", "residual.sugar", "density")
ggpairs(wine_quality,
        columns = wq.names.alcohol,
        mapping = aes(color = quality),
        lower = list(continuous = ggscatalpha), 
        diag = list(continuous = ggdensalpha))
```

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
